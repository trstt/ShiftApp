<!DOCTYPE html>
<html>
<!--
  * Please see the included README.md file for license terms and conditions.
  -->
<head>
    <title>The  Shift 2017 Official App</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">

    <!-- see http://webdesign.tutsplus.com/tutorials/htmlcss-tutorials/quick-tip-dont-forget-the-viewport-meta-tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <style>
        /* following two viewport lines are equivalent to the meta viewport statement above, needed for Windows */
        /* see http://www.quirksmode.org/blog/archives/2014/05/html5_dev_conf.html and http://dev.w3.org/csswg/css-device-adapt/ */
        @-ms-viewport { width: 100vw ; zoom: 100% ; }  @viewport { width: 100vw ; zoom: 100% ; }
        @-ms-viewport { user-zoom: fixed ; }           @viewport { user-zoom: fixed ; }
    </style>

    <script src="cordova.js"></script>          <!-- phantom library, needed for Cordova api calls, added during build -->
    <script src="js/app.js"></script>           <!-- recommended location of your JavaScript code relative to other JS files -->
    <script src="xdk/init-dev.js"></script>     <!-- normalizes device and document ready events, see README for details -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/shift-styles.css">
    <link href="css/carousel.css" rel="stylesheet">
	<link href="css/pitch.css" rel="stylesheet">
</head>
<body>
<div class="wrapper">
    <div id="menu">
        <div id="logomenu">
            <img class="logo" src="img/Shift_Color.png">
        </div>
        <ul>
            <li>
                <a href="index.html">
					<img class="linkicon" src="img/menuicons/menu.png">
                    Main
                </a>
            </li>
            <li>
                <a href="map.html">
					<img class="linkicon" src="img/menuicons/map.png">
                    Map
                </a>
            </li>
            <li>
                <a href="program2.html">
					<img class="linkicon" src="img/menuicons/prog.png">
                    Program
                </a>
            </li>
            <li>
				<a href="schedule.html">
					<img class="linkicon" src="img/menuicons/time.png">
                	Time table
				</a>
            </li>
			<li>
				<a href="voting.html">
                    <img class="linkicon" src="img/menuicons/pitch.png">
                	Pitch competition
				</a>
            </li>
            <li>
                <a href="matchma.html">
					<img class="linkicon" src="img/menuicons/brella.png">
                    Matchmaking
                </a>
            </li>
            <li>
				<a href="infopage.html">
					<img class="linkicon" src="img/menuicons/info.png">
					Info
				</a>
            </li>
        </ul>
    </div>
    <div id="content">
        <!--<div class="swipeOpenMenu" id="swipeOpenMenu"></div>-->
        <div class="closeMenu" id="closeMenu"></div>
        <nav class="navbar navbar-default">
            <a id="openMenu" class="navbar-brand" href="#">
                <i class="fa fa-bars" aria-hidden="true"></i>
            </a>
        </nav>

        <div class="container">
			<div class = tabbar>
                <div class ="tab pitch" onclick="location.href='pitch.html'">PITCHERS</div>
                <div class ="tab vote active" onclick="location.href='voting.html'">VOTING</div>
            </div>
            <div class = "SHDW"></div>
			<h1>Vote for your favorites</h1>
			<form name="votingForm" id="votingForm" method="post" action="http://c5kj8xbh.c5.suncomet.fi/shift/vote2.php">
				<div id="votingCompetititors">
					<label for="1">
						<input type="checkbox" id="1" value="1" name="votes[]">PITCHER 1
						<i class="fa fa-check fa-6 voteCheckmark" aria-hidden="true"></i>
					</label>
					<label for="2">
						<input type="checkbox" id="2" value="2" name="votes[]">PITCHER 2
						<i class="fa fa-check fa-6 voteCheckmark" aria-hidden="true"></i>
					</label>
					<label for="3">
						<input type="checkbox" id="3" value="3" name="votes[]">PITCHER 3
						<i class="fa fa-check fa-6 voteCheckmark" aria-hidden="true"></i>
					</label>
					<label for="4">
						<input type="checkbox" id="4" value="4" name="votes[]">PITCHER 4
						<i class="fa fa-check fa-6 voteCheckmark" aria-hidden="true"></i>
					</label>
					<label for="5">
						<input type="checkbox" id="5" value="5" name="votes[]">PITCHER 5
						<i class="fa fa-check fa-6 voteCheckmark" aria-hidden="true"></i>
					</label>
					<label for="6">
						<input type="checkbox" id="6" value="6" name="votes[]">PITCHER 6
						<i class="fa fa-check fa-6 voteCheckmark" aria-hidden="true"></i>
					</label>
					<label for="7">
						<input type="checkbox" id="7" value="7" name="votes[]">PITCHER 7
						<i class="fa fa-check fa-6 voteCheckmark" aria-hidden="true"></i>
					</label>
					<label for="8">
						<input type="checkbox" id="8" value="8" name="votes[]">PITCHER 8
						<i class="fa fa-check fa-6 voteCheckmark" aria-hidden="true"></i>
					</label>
					<label for="9">
						<input type="checkbox" id="9" value="9" name="votes[]">PITCHER 9
						<i class="fa fa-check fa-6 voteCheckmark" aria-hidden="true"></i>
					</label>
					<label for="10">
						<input type="checkbox" id="10" value="10" name="votes[]">PITCHER 10
						<i class="fa fa-check fa-6 voteCheckmark" aria-hidden="true"></i>
					</label>
				</div>

				<input type="hidden" id="voterUUID" name="voterUUID" value="">
				<input type=submit value="Vote">
				<p id="response"></p>
			</form>
        </div>
    </div>
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.mobile-events.min.js"></script>
<script type='application/javascript' src='js/inAppBrowser.js'></script>
<script>
    $(document).ready(function(){
		//GET DEVICE UUID
		document.addEventListener("deviceready", onDeviceReady, false);
		function onDeviceReady() {
			$('#voterUUID').val(device.uuid);// AJAX CHECK IF DEVICE HAS VOTED
			var checkVotes = function(){
				$.ajax({
					data: $('#votingForm').serialize(),
					type: 'POST',
					url: 'http://c5kj8xbh.c5.suncomet.fi/shift/checkvotes2.php',
					success: function(response) {
						var response = JSON.parse(response);
						var votesGiven = 0;

						//lock form inputs according to given votes already in the DB
						//horrible individual check of each vote value
						if(response){
							if(response.v1 != 0){
								$('#' + response.v1).addClass('givenVote');
								votesGiven++;
							};
							if(response.v2 != 0){
								$('#' + response.v2).addClass('givenVote');
								votesGiven++;
							};
							if(response.v3 != 0){
								$('#' + response.v3).addClass('givenVote');
								votesGiven++;
							};
							if(response.v4 != 0){
								$('#' + response.v4).addClass('givenVote');
								votesGiven++;
							};
							if(response.v5 != 0){
								$('#' + response.v5).addClass('givenVote');
								votesGiven++;
							};
							$('.givenVote')
								.attr('checked', true)
								.attr('disabled', true)
								.change()
								.parent().css({'filter' : 'grayscale(80%) brightness(150%)', 'color' : 'gray'})				.children('.voteCheckmark').addClass('showCheck')
								.addClass('checkedComponent');
						}

						//if five votes already given, disable everything and show response
						if(votesGiven === 5){
							$('input[type="checkbox"]').each(function(){
								$(this).attr('disabled', true);
							});
							$('input[type="submit"]').attr('disabled', true);
							$('#response').html('<h1>Thank you!</h1> <h4>You have used all your votes</h4>')
						};
					}
				});
				return false; // cancel original event to prevent form submitting
			};
			checkVotes();
		};

		//////////////  VOTING FORM  //////////////
		$( document ).ajaxError(function( event, request, settings ) {
			$( "#response" )
				.html( "<h1>Something went wrong</h1><h4>Error connecting to server</h4>" )
		  		.css("opacity", 1)
				.fadeTo(2500, 0);
		});

		// AJAX - SEND VOTES
		$('#votingForm').submit(function() { // catch the form's submit event
			var data = $(this).serializeArray();
			if (data.length != 1){
				$('.givenVote').removeAttr('disabled');
				var data = $(this).serializeArray();
				//if less than five votes given, push zeroes til five votes in array
				while(data.length < 6){
					data.push({name: 'votes[]',value: '0'});
				};

				$.ajax({
					data: data,
					type: $(this).attr('method'),
					url: $(this).attr('action'),
					success: function(response) {
						location.reload();
					}
				});
			} else{
				$('#response').html('<p>Pick at least one pitch to vote for!</p>')
			}

			return false; // cancel original event to prevent form submitting
		});

		// show and fadeout response text
		$('input[type="submit"]').tapend(function(){
			$('#response')
				.stop()
				.css("opacity", 1)
				.fadeTo(5000, 0);
		});

		var votesLeft = function (){
			var checked = 5 - $('input[type="checkbox"]:checked').length;
			$('#response').html(checked + ' votes left');
		};
		votesLeft();

		$('input[type="checkbox"]').change(function(){
			votesLeft();
			$(this).parent().toggleClass("checkedComponent");

			//$(this).siblings('.voteCheckmark').toggleClass("showCheck")

			var checked = $('input[type="checkbox"]:checked').length;
			if(checked < 4){
				$('input[type="submit"]').attr('disabled', false);
			} else if(checked === 4){
				$('input[type="checkbox"]:not(.givenVote)').each(function(){
					$(this).attr('disabled', false);
				});
			} else {
				$('input[type="checkbox"]:not(:checked):not(.givenVote)').each(function(){
					$(this).attr('disabled', true);
				});
			}
		});

		$('input[type="checkbox"]:checked').each(function(){
			$(this).parent().toggleClass("checkedComponent");
		});

		/*$('#votingForm label').on('click, tapend', function(){
			console.log('moro')
			$(this).children('input[type="checkbox"]').change();
		});*/

		//////////////  END VOTING FORM  //////////////

        function qs(key) {
            key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); // escape RegEx meta chars
            var match = location.search.match(new RegExp("[?&]" + key + "=([^&]+)(&|$)"));
            var slide = match && decodeURIComponent(match[1].replace(/\+/g, " "));
            if (Math.floor(slide) == slide && $.isNumeric(slide))
                return parseInt(slide);
            else
                return 0;
        }
        $('#myCarousel').carousel(qs('slide'));
    });
    // SIDE MENU

    $('#openMenu').tapend(function(){
        $('.wrapper').animate(
			{left: '0'},
			200,
			"linear"
		);
        $('#closeMenu').css('display','block');
    }).stop(true);
	$('#swipeOpenMenu').tapmove(function(){
        $('.wrapper').animate(
			{left: '0'},
			200,
			"swing"
		);
        $('#closeMenu').css('display','block');
    }).stop(true);

    $('.closeMenu').on('tapend tapmove', function(){
        $('.wrapper').animate(
			{
				left: '-80vw',
			},
			100,
			"swing"
		);
        $(this).css('display', 'none');
    }).stop(true);

/*  // MENU SWIPE FROM LEFT
    $('#content').swiperight(function(){
        $('.wrapper').animate({left:'0px'});
        $('#closeMenu').css('display','block');
    });
*/

</script>
</body>
</html>
